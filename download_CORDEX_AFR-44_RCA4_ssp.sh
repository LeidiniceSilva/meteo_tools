#!/bin/bash

#SBATCH -N 1
#SBATCH -t 24:00:00
#SBATCH -J AFR-44_CORDEX
#SBATCH -p esp
#SBATCH --mail-type=FAIL,END
#SBATCH --mail-user=mda_silv@ictp.it

rcm="RCA4"
gcm="MPI-M-MPI-ESM-LR"
exp="rcp85"
member="r1i1p1"

if [ ${gcm} == 'NCC-NorESM1-M' ]; then
	version="v20130927"
	declare -a YEARS=("20060101-20101231" "20110101-20151231" "20160101-20201231" "20210101-20251231" "20260101-20301231" "20310101-20351231" "20360101-20401231" "20410101-20451231" "20460101-20501231" "20510101-20551231" "20560101-20601231" "20610101-20651231" "20660101-20701231" "20710101-20751231" "20760101-20801231"	"20810101-20851231" "20860101-20901231"	"20910101-20951231" "20960101-20991231")
elif [ ${gcm} == 'MPI-M-MPI-ESM-LR' ]; then
	version="v20130927"
	declare -a YEARS=("20060101-20101231" "20110101-20151231" "20160101-20201231" "20210101-20251231" "20260101-20301231" "20310101-20351231" "20360101-20401231" "20410101-20451231" "20460101-20501231" "20510101-20551231" "20560101-20601231" "20610101-20651231" "20660101-20701231" "20710101-20751231" "20760101-20801231"	"20810101-20851231" "20860101-20901231"	"20910101-20951231" "20960101-20991231")
else # MOHC-HadGEM2-ES
	version="v20130927"
	declare -a YEARS=("20060101-20101230" "20110101-20151230" "20160101-20201230" "20210101-20251230" "20260101-20301230" "20310101-20351230" "20360101-20401230" "20410101-20451230" "20460101-20501230" "20510101-20551230" "20560101-20601230" "20610101-20651230" "20660101-20701230" "20710101-20751230" "20760101-20801230"	"20810101-20851230" "20860101-20901230"	"20910101-20951230" "20960101-20991230")
fi

var_list="pr tasmax tasmin"

echo "Starting download"
for var in ${var_list[@]}; do

	base_url="https://data.meteo.unican.es/thredds/fileServer/esgf/replica/raw/cordex/output/AFR-44/SMHI/${gcm}/${exp}/${member}/${rcm}/v1/day/${var}/${version}"

	for year in "${YEARS[@]}"; do

		filename="${var}_AFR-44_${gcm}_${exp}_${member}_SMHI-${rcm}_v1_day_${year}.nc"	   
		url=${base_url}/${filename}
		
		dir="/home/mda_silv/clima-archive2-b/CORDEX/AFR-44/${rcm}/${gcm}"

		echo "Downloading: $filename"
		wget -c -P "$dir" ${url}
	done
done

echo "Finished downloads."
